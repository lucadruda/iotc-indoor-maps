<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>Indoor Maps App</title>
    <link
      rel="stylesheet"
      href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://atlas.microsoft.com/sdk/javascript/indoor/0.1/atlas-indoor.min.css"
      type="text/css"
    />

    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
    <script src="https://atlas.microsoft.com/sdk/javascript/indoor/0.1/atlas-indoor.min.js"></script>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }

      #map-id {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div id="map-id"></div>
    <script type="text/javascript">
      const subscriptionKey = "lR1ByZj_gPUI-joGKchxrimkIzrms0CoMO_bvEmOCtM";
      const tilesetId = "b5881c4b-2149-a364-7e15-5ee2f339e26b";
      const statesetId = "8860bfe7-d0c9-3813-7e68-46f9d838eb45";

      const map = new atlas.Map("map-id", {
        //use your facility's location
        center: [-122.1321, 47.636457],
        //or, you can use bounds: [# west, # south, # east, # north] and replace # with your Map bounds
        style: "blank",
        view: "Auto",
        authOptions: {
          authType: "subscriptionKey",
          subscriptionKey: subscriptionKey,
        },
        zoom: 18.5,
      });
      map.events.add("ready", () => {
        const levelControl = new atlas.control.LevelControl({
          position: "top-right",
        });

        const indoorManager = new atlas.indoor.IndoorManager(map, {
          levelControl: levelControl, //level picker
          tilesetId: tilesetId,
          statesetId: statesetId, // Optional
        });

        if (statesetId.length > 0) {
          indoorManager.setDynamicStyling(true);
        }

        map.events.add("levelchanged", indoorManager, (eventData) => {
          //put code that runs after a level has been changed
          console.log("The level has changed:", eventData);
        });

        map.events.add("facilitychanged", indoorManager, (eventData) => {
          //put code that runs after a facility has been changed
          console.log("The facility has changed:", eventData);
        });

        map.events.add("click", function (e) {
          const features = map.layers.getRenderedShapes(e.position, "unit");
          console.log(features);
        });
      });
    </script>
  </body>
</html>
